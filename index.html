<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Entregas</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif }
body { margin:0; background:#f4f6f8 }

header {
  background:#1e88e5;
  color:#fff;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:bold;
}

header button {
  background:#e53935;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

.container { padding:15px; max-width:900px; margin:auto }

.card {
  background:#fff;
  border-radius:12px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  border-left:6px solid #9e9e9e;
}

.card.entregue { border-left-color:#43a047; background:#e8f5e9 }
.card.pendente { border-left-color:#9e9e9e }
.card.nao_entregue { border-left-color:#e53935; background:#fdecea }

.row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px }

input, select {
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

button {
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#1e88e5;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

button.done { background:#43a047 }
button.nao { background:#e53935 }
button.del { background:#b71c1c }

.status { font-size:13px; margin-top:6px }

/* LOGIN */
#loginArea {
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.login-card {
  background:#fff;
  padding:20px;
  border-radius:14px;
  width:100%;
  max-width:360px;
  box-shadow:0 6px 16px rgba(0,0,0,.15);
}

@media print {
  body * { visibility:hidden }
  #printArea, #printArea * { visibility:visible }
  #printArea {
    position:absolute;
    left:0; top:0;
    width:100%;
  }
}

#printArea table {
  width:100%;
  border-collapse:collapse;
  margin-bottom:30px;
}
#printArea th, #printArea td {
  border:1px solid #000;
  padding:6px;
}
#printArea th { background:#eee }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginArea">
  <div class="login-card">
    <h2>üîê Entrar</h2>
    <input id="loginUser" placeholder="Usu√°rio">
    <br><br>
    <input id="loginPass" type="password" placeholder="Senha">
    <br><br>
    <button onclick="login()">Entrar</button>
    <p id="loginErro" style="color:red; display:none">Usu√°rio ou senha inv√°lidos</p>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
<header>
  <span>üì¨ Controle de Entregas</span>
  <button onclick="logout()">Sair</button>
</header>

<div class="container">

<div class="card">
  <h3>‚ûï Nova Entrega</h3>
  <input id="condominioInput" placeholder="Condom√≠nio">
  <div class="row">
    <input id="blocoInput" placeholder="Bloco">
    <input id="portaInput" placeholder="Apartamento">
  </div>
  <button onclick="adicionar()">Adicionar</button>
</div>

<div class="card">
  <h3>üîç Filtro por condom√≠nio</h3>
  <select id="filtro" onchange="render()"></select>
  <div id="contador" class="status"></div>
</div>

<div class="card">
  <h3>üñ®Ô∏è Imprimir</h3>
  <button onclick="imprimir()">Imprimir por bloco</button>
</div>

<div id="lista"></div>

</div>
</div>

<div id="printArea"></div>

<script>
const usuarios = [
  { user:'Thiago', pass:'123' },
  { user:'Fabio', pass:'123' }
];

let entregas = [];

/* üîπ PR√â-CADASTRO AUTOM√ÅTICO */
function preloadWellington() {
  const user = localStorage.user;
  const key = 'entregas_' + user;
  let dados = JSON.parse(localStorage.getItem(key)) || [];

  const existe = dados.some(e => e.condominio === 'wellington');
  if (existe) return;

  for (let i = 1; i <= 176; i++) {
    dados.push({
      condominio: 'wellington',
      bloco: '01',
      porta: String(i).padStart(3,'0'),
      status: 'pendente'
    });
  }
  localStorage.setItem(key, JSON.stringify(dados));
}

function login(){
  const ok = usuarios.find(u => u.user === loginUser.value && u.pass === loginPass.value);
  if(!ok){ loginErro.style.display='block'; return; }
  localStorage.user = ok.user;
  iniciar();
}

function logout(){
  localStorage.clear();
  location.reload();
}

function iniciar(){
  loginArea.style.display='none';
  app.style.display='block';

  preloadWellington();

  entregas = JSON.parse(localStorage.getItem('entregas_'+localStorage.user)) || [];
  render();
}

function salvar(){
  localStorage.setItem('entregas_'+localStorage.user, JSON.stringify(entregas));
}

function adicionar(){
  if(!condominioInput.value || !blocoInput.value || !portaInput.value) return;
  entregas.push({
    condominio:condominioInput.value,
    bloco:blocoInput.value.toUpperCase(),
    porta:portaInput.value,
    status:'pendente'
  });
  salvar();
  condominioInput.value = blocoInput.value = portaInput.value = '';
  render();
}

function marcar(i,s){
  entregas[i].status = s;
  salvar();
  render();
}

function deletar(i){
  if(confirm('Excluir entrega?')){
    entregas.splice(i,1);
    salvar();
    render();
  }
}

function ordenar(lista){
  return lista.sort((a,b)=>{
    if(a.bloco!==b.bloco) return a.bloco.localeCompare(b.bloco);
    return a.porta.localeCompare(b.porta,undefined,{numeric:true});
  });
}

function render(){
  const f = filtro.value;
  const condominios = [...new Set(entregas.map(e=>e.condominio))];
  filtro.innerHTML = '<option value="">Todos</option>';
  condominios.forEach(c=>filtro.innerHTML+=`<option>${c}</option>`);
  filtro.value = f;

  let list = f ? entregas.filter(e=>e.condominio===f) : entregas;
  list = ordenar(list);

  lista.innerHTML='';
  const ent = list.filter(e=>e.status==='entregue').length;
  const pen = list.filter(e=>e.status==='pendente').length;
  const nao = list.filter(e=>e.status==='nao_entregue').length;
  contador.innerHTML = `‚úîÔ∏è ${ent} | ‚è≥ ${pen} | ‚ùå ${nao}`;

  list.forEach(e=>{
    const i = entregas.indexOf(e);
    lista.innerHTML += `
    <div class="card ${e.status}">
      <h3>${e.condominio} ‚Äî Bloco ${e.bloco}</h3>
      <div>üö™ Apto ${e.porta}</div>
      <div class="row">
        <button class="done" onclick="marcar(${i},'entregue')">Entregue</button>
        <button class="nao" onclick="marcar(${i},'nao_entregue')">N√£o</button>
        <button class="del" onclick="deletar(${i})">Del</button>
      </div>
      <div class="status">${e.status}</div>
    </div>`;
  });
}

function imprimir(){
  const f = filtro.value;
  if(!f) return alert('Selecione um condom√≠nio');
  const list = entregas.filter(e=>e.condominio===f);
  let html = `<h2>Condom√≠nio: ${f}</h2>`;
  [...new Set(list.map(e=>e.bloco))].forEach(b=>{
    html+=`<h3>Bloco ${b}</h3><table>
    <tr><th>Apto</th><th>Status</th><th>Assinatura</th></tr>`;
    list.filter(e=>e.bloco===b).forEach(e=>{
      html+=`<tr><td>${e.porta}</td><td>${e.status}</td><td></td></tr>`;
    });
    html+='</table>';
  });
  printArea.innerHTML=html;
  window.print();
}

if(localStorage.user) iniciar();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Controle de Entregas</title>

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif;-webkit-tap-highlight-color:transparent}
body{margin:0;background:#f4f6f8}
header{background:#1e88e5;color:#fff;padding:14px;display:flex;justify-content:space-between;align-items:center;font-weight:bold;position:sticky;top:0}
.container{padding:12px;max-width:900px;margin:auto}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,.08);border-left:6px solid #9e9e9e}
.card.entregue{border-left-color:#43a047;background:#e8f5e9}
.card.nao_entregue{border-left-color:#e53935;background:#fdecea}
input,select{width:100%;padding:14px;font-size:16px;border-radius:10px;border:1px solid #ccc}
button{width:100%;padding:14px;font-size:16px;border:none;border-radius:12px;background:#1e88e5;color:#fff;font-weight:bold}
button.done{background:#43a047}
button.nao{background:#e53935}
button.del{background:#b71c1c}
.row{display:flex;gap:8px;flex-wrap:wrap}
.status{margin-top:8px;font-size:14px}
#loginArea{min-height:100vh;display:flex;align-items:center;justify-content:center}
.login-card{background:#fff;padding:22px;border-radius:16px;width:100%;max-width:360px;box-shadow:0 6px 16px rgba(0,0,0,.15)}
@media print{
body *{visibility:hidden}
#printArea,#printArea *{visibility:visible}
#printArea{position:absolute;left:0;top:0;width:100%}
#printArea table{width:100%;border-collapse:collapse}
#printArea th,#printArea td{border:1px solid #000;padding:6px}
#printArea th{background:#eee}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginArea">
  <div class="login-card">
    <h2>üîê Entrar</h2>
    <input id="loginUser" placeholder="Usu√°rio">
    <br><br>
    <input id="loginPass" type="password" placeholder="Senha">
    <br><br>
    <button onclick="login()">Entrar</button>
    <p id="loginErro" style="color:red;display:none">Usu√°rio ou senha inv√°lidos</p>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
<header>
  <span>üì¨ Controle de Entregas</span>
  <button onclick="logout()">Sair</button>
</header>

<div class="container">

<div class="card">
  <h3>‚ûï Nova Entrega</h3>
  <input id="condominioInput" placeholder="Condom√≠nio">
  <br><br>
  <input id="blocoInput" placeholder="Bloco">
  <br><br>
  <input id="portaInput" placeholder="Apartamento">
  <br><br>
  <button onclick="adicionar()">Adicionar</button>
</div>

<div class="card">
  <h3>üîç Filtros</h3>
  <select id="filtroCondominio" onchange="render()"></select>
  <br><br>
  <select id="filtroBloco" onchange="render()"></select>
  <div id="contador" class="status"></div>
</div>

<div class="card">
  <h3>üñ®Ô∏è Imprimir</h3>
  <button onclick="imprimir()">Imprimir por bloco</button>
</div>

<div id="lista"></div>

</div>
</div>

<div id="printArea"></div>

<script>
const usuarios=[{user:'Thiago',pass:'1234'},{user:'Fabio',pass:'123'}];
let entregas=[];

/* PR√â-CADASTRO */
function preloadCondominio(){
  const key='entregas_'+localStorage.user;
  let dados=JSON.parse(localStorage.getItem(key))||[];
  const cond='Pra√ßa das Am√©ricas 662';
  ['01','02','03'].forEach(bloco=>{
    for(let i=1;i<=176;i++){
      const apto=String(i).padStart(3,'0');
      if(!dados.some(e=>e.condominio===cond&&e.bloco===bloco&&e.porta===apto)){
        dados.push({condominio:cond,bloco,porta:apto,status:'pendente'});
      }
    }
  });
  localStorage.setItem(key,JSON.stringify(dados));
}

function login(){
  const ok=usuarios.find(u=>u.user===loginUser.value&&u.pass===loginPass.value);
  if(!ok){loginErro.style.display='block';return}
  localStorage.user=ok.user;
  iniciar();
}

function logout(){localStorage.clear();location.reload()}

function iniciar(){
  loginArea.style.display='none';
  app.style.display='block';
  preloadCondominio();
  entregas=JSON.parse(localStorage.getItem('entregas_'+localStorage.user))||[];
  render();
}

function salvar(){localStorage.setItem('entregas_'+localStorage.user,JSON.stringify(entregas))}

function adicionar(){
  if(!condominioInput.value||!blocoInput.value||!portaInput.value)return;
  entregas.push({
    condominio:condominioInput.value,
    bloco:blocoInput.value.toUpperCase(),
    porta:portaInput.value,
    status:'pendente'
  });
  salvar();condominioInput.value=blocoInput.value=portaInput.value='';render();
}

function marcar(i,s){entregas[i].status=s;salvar();render()}
function deletar(i){if(confirm('Excluir entrega?')){entregas.splice(i,1);salvar();render()}}

function render(){
  const fc=filtroCondominio.value;
  const fb=filtroBloco.value;

  filtroCondominio.innerHTML='<option value="">Todos condom√≠nios</option>';
  [...new Set(entregas.map(e=>e.condominio))].forEach(c=>{
    filtroCondominio.innerHTML+=`<option>${c}</option>`;
  });
  filtroCondominio.value=fc;

  filtroBloco.innerHTML='<option value="">Todos blocos</option>';
  [...new Set(entregas.map(e=>e.bloco))].forEach(b=>{
    filtroBloco.innerHTML+=`<option>${b}</option>`;
  });
  filtroBloco.value=fb;

  let list=entregas;
  if(fc) list=list.filter(e=>e.condominio===fc);
  if(fb) list=list.filter(e=>e.bloco===fb);

  list.sort((a,b)=>a.porta.localeCompare(b.porta,undefined,{numeric:true}));

  lista.innerHTML='';
  contador.innerHTML=`Total: ${list.length}`;

  list.forEach(e=>{
    const i=entregas.indexOf(e);
    lista.innerHTML+=`
    <div class="card ${e.status}">
      <h3>${e.condominio} ‚Äî Bloco ${e.bloco}</h3>
      <div>üö™ Apto ${e.porta}</div>
      <div class="row">
        <button class="done" onclick="marcar(${i},'entregue')">Entregue</button>
        <button class="nao" onclick="marcar(${i},'nao_entregue')">N√£o</button>
        <button class="del" onclick="deletar(${i})">Del</button>
      </div>
      <div class="status">${e.status}</div>
    </div>`;
  });
}

function imprimir(){
  const fc=filtroCondominio.value;
  const fb=filtroBloco.value;
  if(!fc||!fb)return alert('Selecione condom√≠nio e bloco');
  const list=entregas.filter(e=>e.condominio===fc&&e.bloco===fb);
  let html=`<h2>${fc} ‚Äî Bloco ${fb}</h2>
  <table><tr><th>Apto</th><th>Status</th><th>Assinatura</th></tr>`;
  list.forEach(e=>{
    html+=`<tr><td>${e.porta}</td><td>${e.status}</td><td></td></tr>`;
  });
  html+='</table>';
  printArea.innerHTML=html;
  window.print();
}

if(localStorage.user)iniciar();
</script>

</body>
</html>